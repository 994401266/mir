<#import "/movie/common.html" as common>
<!DOCTYPE html>
<html lang="en">
<head>
<title>List</title>
<!-- for-mobile-apps -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
		function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- //for-mobile-apps -->
<link href="${ctx}/img/film/css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="${ctx}/img/film/css/style.css" rel="stylesheet" type="text/css" media="all" />
<link rel="stylesheet" href="${ctx}/img/film/css/faqstyle.css" type="text/css" media="all" />
<link href="${ctx}/img/film/css/medile.css" rel='stylesheet' type='text/css' />
<link href="${ctx}/img/film/css/single.css" rel='stylesheet' type='text/css' />
<link rel="stylesheet" href="${ctx}/img/film/css/contactstyle.css" type="text/css" media="all" />
<!-- news-css -->
<link rel="stylesheet" href="${ctx}/img/film/news-css/news.css" type="text/css" media="all" />
<!-- //news-css -->
<!-- list-css -->
<link rel="stylesheet" href="${ctx}/img/film/list-css/list.css" type="text/css" media="all" />
<!-- //list-css -->
<!-- font-awesome icons -->
<link rel="stylesheet" href="${ctx}/img/film/css/font-awesome.min.css" />
<!-- //font-awesome icons -->
<link rel="stylesheet" type="text/css" href="${ctx}/img/film/css/list.css"/>
<!-- js -->
<script type="text/javascript" src="${ctx}/img/film/js/jquery-2.1.4.min.js"></script>
<!-- //js -->
<!---<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700italic,700,400italic,300italic,300' rel='stylesheet' type='text/css'>--->
<!-- start-smoth-scrolling -->
<script type="text/javascript" src="${ctx}/img/film/js/move-top.js"></script>
<script type="text/javascript" src="${ctx}/img/film/js/easing.js"></script>
<script type="text/javascript">
	jQuery(document).ready(function($) {
		$(".scroll").click(function(event){		
			event.preventDefault();
			$('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
		});
	});
</script>
<!-- start-smoth-scrolling -->
<!-- tables -->
<link rel="stylesheet" type="text/css" href="${ctx}/img/film/list-css/table-style.css" />
<link rel="stylesheet" type="text/css" href="${ctx}/img/film/list-css/basictable.css" />
<script type="text/javascript" src="${ctx}/img/film/list-js/jquery.basictable.min.js"></script>
 <script type="text/javascript">
    $(document).ready(function() {
      $('#table').basictable();

      $('#table-breakpoint').basictable({
        breakpoint: 768
      });
	   $('#table-breakpoint1').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint2').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint3').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint4').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint5').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint6').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint7').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint8').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint9').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint10').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint11').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint12').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint13').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint14').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint15').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint16').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint17').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint18').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint19').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint20').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint21').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint22').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint23').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint24').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint25').basictable({
        breakpoint: 768
      });
	  $('#table-breakpoint26').basictable({
        breakpoint: 768
      });
    });
  </script>
<!-- //tables -->
</head>
	
<body>
<@common.header />
<div class="general_social_icons">
	<nav class="social">
		<ul>
			<li class="w3_twitter"><a href="${ctx}/img/film/#">Twitter <i class="fa fa-twitter"></i></a></li>
			<li class="w3_facebook"><a href="${ctx}/img/film/#">Facebook <i class="fa fa-facebook"></i></a></li>
			<li class="w3_dribbble"><a href="${ctx}/img/film/#">Dribbble <i class="fa fa-dribbble"></i></a></li>
			<li class="w3_g_plus"><a href="${ctx}/img/film/#">Google+ <i class="fa fa-google-plus"></i></a></li>				  
		</ul>
  </nav>
</div>
<!-- faq-banner -->
	<div class="faq">
		<h4 class="latest-text w3_faq_latest_text w3_latest_text">Movies List</h4>
			<div class="container">
				<div class="agileits-news-top">
					<ol class="breadcrumb">
					  <li><a href="${ctx}/img/film/index.html">Home</a></li>
					  <li class="active">List</li>
					</ol>
				</div>
				<div class="bs-example bs-example-tabs" role="tabpanel" data-example-id="togglable-tabs">
				<script type="text/javascript">
					$(function() {
						//加载电影类型
						$.ajax({
							type: "POST",
							data:{page:false},
							url:'${ctx}/front/dicdata/movieCat/list/json',
							success:function(res){
								if(res.status == 'success'){
									var data = res.data;
									var movieCateLiText = '<li data-name="" class="active">全部</li>';
									if(!!data){
										for(var key = 0; key < data.length; key++){
											movieCateLiText += '<li data-name="'+data[key].name+'">'+data[key].name+'</li>';
										    }
										$("#types").html(movieCateLiText);
									}
								}
							}
						});
						//加载国家
						$.ajax({
							type: "POST",
							data:{page:false},
							url:'${ctx}/front/dicdata/area/list/json',
							success:function(res){
								if(res.status == 'success'){
									var data = res.data;
									var movieAreaLiText = '<li data-name="" class="active">全部</li>';
									if(!!data){
										for(var key = 0; key < data.length; key++){
											movieAreaLiText += '<li data-name="'+data[key].name+'">'+data[key].name+'</li>';
										}
										movieAreaLiText += '<li data-name="others">其他</li>';	
										$("#originPlace").html(movieAreaLiText);
									}
								}
							}
						});
					});
				</script>
						<div class="searchCondition">
							<div class="searchItem">
								<span>地区：</span>
								<ul id="originPlace">
									<li>全部</li>
									<li>大陆</li>
									<li>台湾</li>
									<li>韩国</li>
									<li>日本</li>
									<li>欧美</li>
									<li>其他</li>
								</ul>
							</div>
							<div class="searchItem">
								<span>类型：</span>
								<ul id="types">
									<li>全部</li>
									<li>剧集</li>
									<li>电影</li>
									<li>动漫</li>
									<li>综艺</li>
									<li>少儿</li>
									<li>其他</li>
								</ul>
							</div>
							<div class="searchItem">
								<span>年份：</span>
								<ul id="releaseYear">
									<li data-name="" class="active">全部</li>
									<li data-name="2018">2018</li>
									<li data-name="2017">2017</li>
									<li data-name="2016">2016</li>
									<li data-name="2010-2015">2010-2015</li>
									<li data-name="2000-2010">2000-2010</li>
									<li data-id="longAgo" data-name="0-2000">2000以前</li>
								</ul>
							</div>
						</div>
						<div id="myTabContent" class="tab-content">
							<div role="tabpanel" class="tab-pane fade in active" id="home" aria-labelledby="home-tab">
								<div class="agile-news-table">
									<div class="w3ls-news-result">
										<h4>Search Results : <span id="totalSpan">25</span></h4>
									</div>
									<table id="table-breakpoint">
										<thead>
										  <tr>
											<th>No.</th>
											<th>Movie Name</th>
											<th>Year</th>
											<th>runtime</th>
											<th>Country</th>
											<th>Genre</th>
											<th>Rating</th>
										  </tr>
										</thead>
										<tbody id="movieTbody">
										</tbody>
									</table>
								</div>
							</div>
						</div>
				</div>
			</div>
	</div>
	<@common.page thisPage="1" allPage="5" />
	<@common.footer />
<script src="${ctx}/img/film/js/bootstrap.min.js"></script>
<script>
$(document).ready(function(){
    $(".dropdown").hover(            
        function() {
            $('.dropdown-menu', this).stop( true, true ).slideDown("fast");
            $(this).toggleClass('open');        
        },
        function() {
            $('.dropdown-menu', this).stop( true, true ).slideUp("fast");
            $(this).toggleClass('open');       
        }
    );
    $(document).on("click",".searchCondition ul li",function(){
    	$(this).toggleClass('active');
    	if($(this).data("name")==''){
    		$(this).siblings().removeClass("active");
    	}else if($(this).data("name")=='others'||$(this).data("id")=='longAgo'){
    		$(this).siblings().removeClass("active");
    	}else{
    		$(this).siblings().first().removeClass("active");
    		if($(this).siblings().last().data("name") == "others"){
    			$(this).siblings().last().removeClass("active");
    		}
    	}
    	loadMovies();
    });
    loadMovies();
});
	function loadMovies(){
		//先取类型
		var map = {};
		$(".searchCondition ul").each(function(){
			var typeStr = ''; 
			$(this).find("li.active").each(function(){
				typeStr += $(this).data("name")+',';
			});
			typeStr = typeStr.slice(0,-1);
			map[$(this).attr("id")] = typeStr;
		});
		map["pageIndex"] = $('[name="pageIndex"]').val();
		console.log(map);
		//根据条件加载加载电影
		//加载电影类型
		$.ajax({
			type: "POST",
			data:map,
			url:'${ctx}/front/movie/list/json',
			success:function(res){
				if(res.status == 'success'){
					//console.log(res.page);
				   //分页
				   setPages((res.page.pageIndex)?(res.page.pageIndex):'1',(res.page.pageCount)?(res.page.pageCount):'1',function(){
					   loadMovies();
					}); 
					var data = res.data;
					var movieListText = '';
					$("#totalSpan").html(res.page.totalCount);
					if(!!data){
						for(var key = 0; key < data.length; key++){
								movieListText += '<tr>';
								movieListText += '<td>'+(key+1)+'</td>';
								movieListText += '<td class="w3-list-img"><a href="${ctx}/front/movie/single/'+data[key].id+'"><img src="${ctx}/img/film/images/n3.jpg" alt="" /> <span>'+data[key].name+'</span></a></td>';
								movieListText += '<td>'+data[key].releaseYear+'</td>';
								movieListText += '<td>'+data[key].runtime+'</td>';
								movieListText += '<td class="w3-list-info"><a href="${ctx}/front/movie/single/'+data[key].id+'">'+data[key].originPlace+'</a></td>';
								movieListText += '<td class="w3-list-info"><a href="${ctx}/front/movie/single/'+data[key].id+'">'+data[key].types+'</a></td>';
								movieListText += '<td>'+data[key].doubanRating+'</td>';
								movieListText += '</tr>';
						    }
						$("#movieTbody").html(movieListText);
					}
				}
			}
		});
	}
</script>
	<script type="text/javascript">
		$(document).ready(function() {
								
			$().UItoTop({ easingType: 'easeOutQuart' });
								
			});
	</script>
</body>
</html>